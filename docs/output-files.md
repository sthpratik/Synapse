# Output Files & Data Reference

This document explains all output files generated by Synapse and the meaning of each column in the reports.

## File Types Overview

Synapse generates different files depending on the mode and configuration:

| File Type | When Generated | Purpose |
|-----------|----------------|---------|
| **Load Test Results** | Always (when running K6) | Performance metrics |
| **Basic Comparison** | Load test with `--compare` | Quick size-based comparison |
| **Detailed Comparison** | Post-processing with pixelmatch/Sharp | Accurate image analysis |
| **Summary Reports** | Comparison enabled | Statistical summaries |

## Load Test Output Files

### `results.json`
**Generated by**: K6 load testing engine  
**Contains**: Raw performance metrics, response times, throughput data

```json
{
  "type": "Point",
  "metric": "http_req_duration",
  "data": {
    "time": "2024-11-12T23:15:00Z",
    "value": 245.67,
    "tags": {
      "status": "200",
      "method": "GET"
    }
  }
}
```

### `test.js` (if `--keep-script` used)
**Generated by**: Synapse K6 generator  
**Contains**: Generated K6 test script with comparison logic

## Comparison Output Files

### `basic-comparison-{date}.csv`
**Generated by**: K6 load test with comparison enabled  
**Contains**: Real-time comparison data during load testing

#### Column Reference

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| `Iteration` | Integer | K6 iteration number (0-based) | `0`, `1`, `2` |
| `URL1` | String | First URL (baseUrl) | `https://v1.api.com/image?w=500` |
| `URL2` | String | Second URL (baseUrl2) | `https://v2.api.com/image?w=500` |
| `ResponseTime(ms)` | Integer | Total time for both requests | `1250` |
| `URL1_Status` | Integer | HTTP status code for URL1 | `200`, `404`, `500` |
| `URL2_Status` | Integer | HTTP status code for URL2 | `200`, `404`, `500` |
| `URL1_Size` | Integer | Response body size in bytes | `15420` |
| `URL2_Size` | Integer | Response body size in bytes | `15420` |
| `SizeMatch` | Boolean | Whether file sizes are identical | `TRUE`, `FALSE` |
| `Similarity%` | Number | Basic similarity (100 if sizes match) | `100`, `0` |
| `Timestamp` | ISO String | When comparison was performed | `2024-11-12T23:15:30.123Z` |

**Use Cases:**
- Quick performance overview during load testing
- Identify response time differences between versions
- Spot obvious failures (status codes, size mismatches)

### `detailed-comparison-{timestamp}.csv`
**Generated by**: Post-processing with pixelmatch/Sharp  
**Contains**: Accurate image comparison using pixel analysis

#### Column Reference

| Column | Type | Description | Example |
|--------|------|-------------|---------|
| **Basic Info** | | | |
| `Iteration` | Integer | K6 iteration number | `0`, `1`, `2` |
| `URL1` | String | First URL tested | `https://v1.api.com/resize?w=500&h=300` |
| `URL2` | String | Second URL tested | `https://v2.api.com/resize?w=500&h=300` |
| `Timestamp` | ISO String | When comparison occurred | `2024-11-12T23:15:30.123Z` |
| **Load Test Performance** | | | |
| `LoadTest_ResponseTime(ms)` | Integer | K6 response time for both requests | `1250` |
| `URL1_Status` | Integer | HTTP status from K6 test | `200` |
| `URL2_Status` | Integer | HTTP status from K6 test | `200` |
| `URL1_Size` | Integer | File size from K6 test | `15420` |
| `URL2_Size` | Integer | File size from K6 test | `15420` |
| `LoadTest_SizeMatch` | Boolean | Size match from K6 | `TRUE` |
| `LoadTest_Similarity%` | Number | Basic similarity from K6 | `100` |
| **Pixelmatch Analysis** | | | |
| `Pixelmatch_Success` | Boolean | Whether pixel analysis succeeded | `TRUE`, `FALSE` |
| `Pixelmatch_ResponseTime(ms)` | Integer | Time for detailed analysis | `450` |
| `Image_Width1` | Integer | Actual image width (URL1) | `500` |
| `Image_Height1` | Integer | Actual image height (URL1) | `300` |
| `Image_Width2` | Integer | Actual image width (URL2) | `500` |
| `Image_Height2` | Integer | Actual image height (URL2) | `300` |
| `Pixelmatch_DiffPixels` | Integer | Number of different pixels | `1250` |
| `Pixelmatch_Similarity%` | Number | **Accurate similarity score** | `95.67` |
| **Text Comparison** | | | |
| `TextMatch` | Boolean | Exact text match (text mode only) | `TRUE`, `FALSE` |
| **Error Handling** | | | |
| `Error` | String | Error category if failed | `Image processing failed` |
| `ErrorDetails` | String | Detailed error message | `Invalid content-type: text/html` |

**Key Metrics:**
- **`Pixelmatch_Similarity%`** - Most accurate image comparison score
- **`Pixelmatch_DiffPixels`** - Exact number of different pixels
- **`Image_Width1/Height1`** - Actual decoded image dimensions

### `detailed-comparison-{timestamp}.json`
**Generated by**: Post-processing  
**Contains**: Same data as CSV but in JSON format for programmatic access

```json
[
  {
    "iteration": 0,
    "url1": "https://v1.api.com/image?w=500",
    "url2": "https://v2.api.com/image?w=500",
    "responseTime": 1250,
    "url1Status": 200,
    "url2Status": 200,
    "detailedComparison": {
      "success": true,
      "similarity": 95.67,
      "diffPixels": 1250,
      "width1": 500,
      "height1": 300
    }
  }
]
```

### `comparison-summary-{timestamp}.json`
**Generated by**: Post-processing  
**Contains**: Statistical summary of all comparisons

```json
{
  "timestamp": "2024-11-12T23:16:00.000Z",
  "totals": {
    "total": 100,
    "successful": 95,
    "failed": 5,
    "successRate": 95.0
  },
  "performance": {
    "avgK6ResponseTime": 1200,
    "avgDetailedResponseTime": 450,
    "avgSimilarity": 87.5
  },
  "errors": {
    "Image processing failed": 3,
    "Timeout": 2
  }
}
```

## Understanding the Data

### Response Times
- **`LoadTest_ResponseTime`**: Time during high-load K6 testing
- **`Pixelmatch_ResponseTime`**: Time for detailed analysis (single-threaded)
- **Difference**: Load test times include network congestion, detailed analysis is isolated

### Similarity Scores
- **`LoadTest_Similarity%`**: Basic comparison (100% if sizes match, 0% if different)
- **`Pixelmatch_Similarity%`**: Accurate pixel-by-pixel comparison (0-100%)
- **Use**: Always use `Pixelmatch_Similarity%` for real image analysis

### Image Dimensions
- **Purpose**: Verify images were decoded correctly
- **Mismatch**: If dimensions differ, images can't be compared pixel-by-pixel
- **Validation**: Check against expected resize parameters

### Error Categories

| Error | Meaning | Solution |
|-------|---------|----------|
| `Invalid content-type` | Server returned HTML/text instead of image | Check API endpoint, authentication |
| `Image processing failed` | Corrupt or unsupported image format | Verify image generation, check logs |
| `Timeout` | Request took too long | Increase timeout, check network |
| `Image dimensions mismatch` | Different image sizes | Check resize parameters consistency |

## File Usage Recommendations

### For Performance Analysis
Use `results.json` and `basic-comparison-{date}.csv`:
- Response time trends
- Throughput comparison
- Error rate analysis

### For Image Quality Analysis  
Use `detailed-comparison-{timestamp}.csv`:
- Focus on `Pixelmatch_Similarity%` column
- Check `Pixelmatch_DiffPixels` for exact differences
- Verify `Image_Width/Height` match expectations

### For Automated Testing
Use `comparison-summary-{timestamp}.json`:
- Check `successRate` for overall health
- Monitor `avgSimilarity` for quality regression
- Alert on error patterns

## Example Analysis Queries

### Excel/Google Sheets Formulas

**Average Similarity:**
```excel
=AVERAGE(K:K)  // Pixelmatch_Similarity% column
```

**Success Rate:**
```excel
=COUNTIF(J:J,"TRUE")/COUNTA(J:J)*100  // Pixelmatch_Success column
```

**Performance Comparison:**
```excel
=AVERAGE(D:D)-AVERAGE(I:I)  // LoadTest vs Pixelmatch response times
```

### SQL Queries (if imported to database)

**Find Low Similarity Images:**
```sql
SELECT URL1, URL2, Pixelmatch_Similarity 
FROM comparisons 
WHERE Pixelmatch_Similarity < 90 
ORDER BY Pixelmatch_Similarity ASC;
```

**Error Analysis:**
```sql
SELECT Error, COUNT(*) as Count 
FROM comparisons 
WHERE Pixelmatch_Success = FALSE 
GROUP BY Error;
```

## File Cleanup

Synapse generates timestamped files to avoid overwrites. Clean up old files periodically:

```bash
# Keep only last 7 days of comparison results
find ./output -name "*comparison*" -mtime +7 -delete

# Keep only basic CSV files (remove detailed analysis)
rm ./output/detailed-comparison-*.csv
```
